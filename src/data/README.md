# Data

## ğŸ“– Overview
The **Data** module handles dataset loading, splitting, and on-the-fly transformations. It uses a **manifest** system (JSONL catalog) to track all images and their metadata, ensuring data lineage and reproducibility.

## ğŸ—ï¸ Architecture / Design

### Manifest System
A JSONL file where each line mimics a database record for one sample.
```json
{"id": "001", "image_path": "data/raw/img1.jpg", "label": "white", "split": "train"}
```
This dissociates the file storage (disk path) from the dataset logic (filtering, labeling), allowing easy versioning and subsetting.

### ManifestDataset
A PyTorch Dataset that:
1. Reads the manifest.
2. Filters by `split` (train/val/test).
3. Loads images lazily.
4. Applies dynamic transforms via `build_transforms`.

## ğŸ”‘ Key Components

### `ManifestDataset`
Main dataset class.
- **Args**: `manifest_path`, `split`, `transform`.
- **Returns**: `(image, label_idx)`.

### `build_transforms`
Factory that builds a torchvision composition from a config dictionary (e.g., brightness, contrast from `preprocessing.yaml`).

## ğŸ’» Usage Examples

### Loading Data
```python
from src.data import ManifestDataset, build_transforms

# Create dataset
dataset = ManifestDataset(
    manifest_path="runs/exp_01/data/manifest.jsonl",
    split="train",
    transform=build_transforms(config={}, is_train=True)
)

# Get sample
image, label = dataset[0]
```

### Weighted Sampling
```python
from torch.utils.data import WeightedRandomSampler

# Get weights inverse to class frequency
weights = dataset.get_sample_weights()
sampler = WeightedRandomSampler(weights, len(weights))
```

## âš™ï¸ Configuration
In `preprocessing.yaml` (generated by `02_prepare_data.py`):

```yaml
transforms:
  brightness:
    factor: 0.2
  contrast:
    factor: 0.2
  gaussian_blur:
    kernel_size: 3
```
