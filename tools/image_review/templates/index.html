<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Review Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Directory Browser Modal (for selecting directories) -->
    <div id="browser-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeBrowser()"></div>
        <div class="modal-content browser-modal">
            <div class="browser-header">
                <h3>üìÅ Select Directory</h3>
                <button class="close-btn" onclick="closeBrowser()">‚úï</button>
            </div>
            <div class="browser-path">
                <button onclick="goToParent()" id="parent-btn">‚¨ÜÔ∏è Parent</button>
                <input type="text" id="current-path" readonly>
            </div>
            <div class="browser-info" id="browser-info"></div>
            <div class="browser-list" id="browser-list">
                <!-- Populated by JS -->
            </div>
            <div class="browser-actions">
                <button onclick="closeBrowser()">Cancel</button>
                <button class="primary" onclick="selectCurrentDirectory()" id="select-dir-btn">
                    Select This Directory
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="main-app">
        <!-- Header -->
        <header>
            <div class="header-left">
                <h1>üñºÔ∏è Image Review Tool</h1>
                <span class="project-name" id="project-title"></span>
                <!-- Directory Mode Info (shown when browsing) -->
                <div class="directory-info hidden" id="directory-info">
                    <span class="directory-path" id="active-directory-path">No directory</span>
                    <select class="mode-select" id="browse-mode" onchange="changeBrowseMode(this.value)">
                        <option value="direct">Direct</option>
                        <option value="recursive">Recursive</option>
                    </select>
                </div>
            </div>
            <div class="toolbar">
                <div class="label-dropdown">
                    <button class="dropdown-toggle" onclick="toggleLabelDropdown()">
                        Labels: <span id="label-count">4 shown</span> ‚ñº
                    </button>
                    <div class="dropdown-menu hidden" id="label-menu">
                        <label>
                            <input type="checkbox" name="vis-label" value="color" checked 
                                   onchange="toggleLabel('color', this.checked)">
                            color
                        </label>
                        <label>
                            <input type="checkbox" name="vis-label" value="brand" checked
                                   onchange="toggleLabel('brand', this.checked)">
                            brand
                        </label>
                        <label>
                            <input type="checkbox" name="vis-label" value="model" checked
                                   onchange="toggleLabel('model', this.checked)">
                            model
                        </label>
                        <label>
                            <input type="checkbox" name="vis-label" value="label"
                                   onchange="toggleLabel('label', this.checked)">
                            label
                        </label>
                        <label>
                            <input type="checkbox" name="vis-label" value="type" checked
                                   onchange="toggleLabel('type', this.checked)">
                            type
                        </label>
                        <label>
                            <input type="checkbox" name="vis-label" value="sub_type"
                                   onchange="toggleLabel('sub_type', this.checked)">
                            sub_type
                        </label>
                        <label>
                            <input type="checkbox" name="vis-label" value="lp_coords"
                                   onchange="toggleLabel('lp_coords', this.checked)">
                            lp_coords
                        </label>
                        <div class="dropdown-actions">
                            <button onclick="selectAllLabels()">Select All</button>
                            <button onclick="clearAllLabels()">Clear All</button>
                        </div>
                        <div class="dropdown-divider"></div>
                        <label class="bbox-toggle">
                            <input type="checkbox" id="show-bbox" checked 
                                   onchange="toggleBoundingBoxes(this.checked)">
                            Show Bounding Boxes
                        </label>
                    </div>
                </div>
                <div class="grid-selector">
                    <button data-size="4" onclick="setGridSize(4)">2√ó2</button>
                    <button data-size="9" class="active" onclick="setGridSize(9)">3√ó3</button>
                    <button data-size="25" onclick="setGridSize(25)">5√ó5</button>
                    <button data-size="36" onclick="setGridSize(36)">6√ó6</button>
                    <button class="custom-grid-btn" id="custom-grid-btn" onclick="openCustomGridModal()" title="Custom Grid Size">‚öô</button>
                </div>
                <div class="bulk-actions">
                    <button class="bulk-action-btn" onclick="selectAllOnPage()" title="Select all images on this page (A)">
                        ‚òë Select Page
                    </button>
                    <button class="bulk-action-btn" onclick="deselectAllOnPage()" title="Deselect all images on this page (D)">
                        ‚òê Deselect Page
                    </button>
                </div>
                <div class="direction-actions">
                    <span class="direction-label">Direction:</span>
                    <button class="direction-btn front" onclick="setAllDirection('front')" title="Set all vehicles to Front (coming toward camera)">
                        ‚ñº Front
                    </button>
                    <button class="direction-btn back" onclick="setAllDirection('back')" title="Set all vehicles to Back (going away from camera)">
                        ‚ñ≤ Back
                    </button>
                </div>
                <div class="toolbar-actions">
                    <button class="filter-toggle-header" onclick="toggleFilterPanel()" title="Toggle Filters ([)" aria-label="Toggle filter panel">
                        <span id="filter-toggle-icon">‚óÄ</span> Filters
                    </button>
                    <button class="help-btn" onclick="openShortcutsHelp()" title="Keyboard Shortcuts (?)" aria-label="Show keyboard shortcuts">?</button>
                    <button class="settings-btn" onclick="openSettings()" title="Settings (,)" aria-label="Open settings">‚öôÔ∏è</button>
                </div>
            </div>
        </header>
        
        <!-- Active Filters Bar -->
        <div class="active-filters-bar hidden" id="active-filters-bar">
            <div class="active-filters-list" id="active-filters-list">
                <!-- Filter chips injected here -->
            </div>
            <button class="btn-clear-all" onclick="clearAllFilters()" id="clear-all-btn">
                Clear All
            </button>
            <span class="filter-summary" id="filter-summary"></span>
        </div>
        
        <!-- Content Wrapper (Sidebar + Grid + Metadata Panel) -->
        <div class="content-wrapper">
        
        <!-- Sidebar Panel (Filters + Directories) -->
        <aside id="filter-panel" class="filter-panel">
            <!-- Sidebar Tabs -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="filters" onclick="switchSidebarTab('filters')">
                    üîç Filters
                </button>
                <button class="sidebar-tab" data-tab="directories" onclick="switchSidebarTab('directories')">
                    üìÅ Directories
                </button>
            </div>
            
            <!-- Tab Content: Filters -->
            <div class="sidebar-tab-content active" id="tab-filters">
                <div class="filter-panel-header">
                    <span class="filter-title">FILTERS</span>
                    <span class="filter-count" id="filter-match-count">0 images</span>
                </div>
                
                <div class="filter-panel-content">
                    <!-- Search Box -->
                    <div class="filter-search">
                        <input type="text" id="filter-search-input" placeholder="üîç Search filters..." 
                               oninput="filterSearchOptions(this.value)" autocomplete="off">
                    </div>
                    
                    <!-- Filter Sections Container -->
                    <div class="filter-sections" id="filter-sections">
                        <!-- Populated by JavaScript -->
                    </div>
                    
                    <!-- Footer -->
                    <div class="filter-panel-footer">
                        <button class="btn-clear-filters" onclick="clearAllFilters()" id="clear-filters-btn" disabled>
                            Clear All Filters
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Tab Content: Directories -->
            <div class="sidebar-tab-content" id="tab-directories">
                <div class="directory-header">
                    <span class="directory-title">BROWSE</span>
                </div>
                
                <div class="directory-toolbar">
                    <button class="btn-icon" onclick="goToParentDirectory()" title="Parent Directory" id="btn-parent-dir">
                        ‚¨ÜÔ∏è
                    </button>
                    <button class="btn-icon" onclick="refreshDirectoryTree()" title="Refresh">
                        üîÑ
                    </button>
                </div>
                
                <div class="directory-tree" id="directory-tree">
                    <!-- Populated by JavaScript -->
                </div>
                
                <div class="directory-actions">
                    <button class="btn-primary" id="btn-activate" onclick="activateDirectory()" disabled>
                        Activate Dataset
                    </button>
                </div>
            </div>
            
            <!-- Collapse Button (works for both tabs) -->
            <button class="filter-collapse-btn" onclick="toggleFilterPanel()" title="Collapse Sidebar">
                <span class="toggle-icon" id="panel-toggle-icon">‚óÄ</span>
            </button>
        </aside>
        
        <!-- Main Content Area -->
        <div class="main-content" id="main-content">
            <!-- Image Grid -->
            <main id="image-grid" class="grid grid-3x3">
                <!-- Images populated by JavaScript -->
            </main>
        </div>
        
        <!-- Metadata Panel (Right Sidebar) -->
        <aside id="metadata-panel" class="metadata-panel collapsed">
            <div class="metadata-panel-header">
                <button class="panel-collapse-btn" onclick="toggleMetadataPanel()" title="Expand/Collapse">
                    <span class="toggle-icon" id="meta-panel-toggle-icon">‚óÄ</span>
                </button>
                <span class="panel-title">DATASET INFO</span>
            </div>
            
            <div class="metadata-panel-content">
                <!-- Statistics Section -->
                <div class="panel-section stats-section">
                    <div class="section-header" onclick="toggleMetadataSection(this)">
                        <span class="section-icon">üìä</span>
                        <span class="section-title">Statistics</span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content" id="stats-content">
                        <div class="no-dataset-message">
                            <div class="message-icon">üìÅ</div>
                            <p>Activate a dataset to view statistics</p>
                        </div>
                    </div>
                </div>
                
                <!-- Properties Section -->
                <div class="panel-section properties-section">
                    <div class="section-header" onclick="toggleMetadataSection(this)">
                        <span class="section-icon">üìã</span>
                        <span class="section-title">Properties</span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content" id="properties-content">
                        <form id="metadata-form" class="metadata-form">
                            <!-- Name (read-only) -->
                            <div class="form-field">
                                <label>Name</label>
                                <input type="text" name="name" id="meta-name" readonly class="readonly">
                            </div>
                            
                            <!-- Description -->
                            <div class="form-field">
                                <label>Description</label>
                                <textarea name="description" id="meta-description" rows="3" placeholder="Enter dataset description..."></textarea>
                            </div>
                            
                            <!-- Camera View (multi-select) -->
                            <div class="form-field">
                                <label>Camera View</label>
                                <div class="checkbox-group" id="camera-view-options">
                                    <label class="checkbox-option">
                                        <input type="checkbox" name="camera_view" value="frontal"> Frontal
                                    </label>
                                    <label class="checkbox-option">
                                        <input type="checkbox" name="camera_view" value="traseira"> Traseira
                                    </label>
                                    <label class="checkbox-option">
                                        <input type="checkbox" name="camera_view" value="panor√¢mica"> Panor√¢mica
                                    </label>
                                    <label class="checkbox-option">
                                        <input type="checkbox" name="camera_view" value="closeup"> Closeup
                                    </label>
                                    <label class="checkbox-option">
                                        <input type="checkbox" name="camera_view" value="super-panor√¢mica"> Super-panor√¢mica
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Quality -->
                            <div class="form-field">
                                <label>Quality</label>
                                <select name="quality" id="meta-quality">
                                    <option value="">Select...</option>
                                    <option value="poor">Poor</option>
                                    <option value="fair">Fair</option>
                                    <option value="good">Good</option>
                                    <option value="excellent">Excellent</option>
                                </select>
                            </div>
                            
                            <!-- Verdict -->
                            <div class="form-field">
                                <label>Verdict</label>
                                <select name="verdict" id="meta-verdict">
                                    <option value="">Select...</option>
                                    <option value="keep">Keep</option>
                                    <option value="revise">Revise</option>
                                    <option value="remove">Remove</option>
                                </select>
                            </div>
                            
                            <!-- Cycle -->
                            <div class="form-field">
                                <label>Cycle</label>
                                <select name="cycle" id="meta-cycle">
                                    <option value="">Select...</option>
                                    <option value="first">First</option>
                                    <option value="second">Second</option>
                                    <option value="third">Third</option>
                                    <option value="fourth">Fourth</option>
                                    <option value="fifth">Fifth</option>
                                </select>
                            </div>
                            
                            <!-- Notes -->
                            <div class="form-field">
                                <label>Notes</label>
                                <textarea name="notes" id="meta-notes" rows="4" placeholder="Additional notes..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="save-btn" onclick="saveDatasetMetadata()">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Stats Configuration Section -->
                <div class="panel-section config-section">
                    <div class="section-header" onclick="toggleMetadataSection(this)">
                        <span class="section-icon">‚öôÔ∏è</span>
                        <span class="section-title">Stats Config</span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content" id="config-content">
                        <div class="stats-config-form">
                            <label>Fields to show in statistics:</label>
                            <div class="checkbox-group" id="stats-fields-options">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="stats_fields" value="label" checked> label
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="stats_fields" value="color" checked> color
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="stats_fields" value="model" checked> model
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="stats_fields" value="quality_flag"> quality_flag
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="stats_fields" value="direction"> direction
                                </label>
                            </div>
                            <button type="button" class="config-save-btn" onclick="saveStatsConfig()">
                                Apply
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        </div><!-- End content-wrapper -->
        
        <!-- Footer -->
        <footer>
            <div class="pagination">
                <button onclick="previousPage()" id="btn-prev" disabled>‚Üê Prev</button>
                <span id="page-info">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                <button onclick="nextPage()" id="btn-next" disabled>Next ‚Üí</button>
            </div>
            <span class="separator">|</span>
            <div class="stats">
                <span>Total: <span id="total-images">0</span></span>
                <span class="separator">|</span>
                <span>Selected: <span id="selected-count">0</span></span>
            </div>
        </footer>
    </div>
    
    <!-- Notification Container -->
    <div id="notifications" class="notifications-container"></div>
    
    <!-- Full-size Image Modal -->
    <div id="image-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeImageModal()"></div>
        <div class="modal-content image-modal-content">
            <button class="modal-close" onclick="closeImageModal()">‚úï</button>
            <div class="modal-nav">
                <button class="nav-btn" onclick="modalPrevImage()" id="modal-prev-btn">‚óÄ</button>
                <button class="nav-btn" onclick="modalNextImage()" id="modal-next-btn">‚ñ∂</button>
            </div>
            <div class="modal-main">
                <div class="modal-image-container">
                    <img id="modal-image" src="" alt="">
                    <div id="modal-labels" class="label-overlay modal-label-overlay">
                        <!-- Labels rendered here -->
                    </div>
                </div>
                <div class="modal-edit-panel" id="modal-edit-panel">
                    <div class="edit-panel-header">
                        <h3>üè∑Ô∏è Edit Labels</h3>
                        <button class="edit-panel-toggle" onclick="toggleEditPanel()" title="Toggle Edit Panel">‚óÄ</button>
                    </div>
                    <div class="edit-panel-content" id="edit-panel-content">
                        <div class="object-selector" id="object-selector">
                            <!-- Object buttons rendered here -->
                        </div>
                        <div class="label-editors" id="label-editors">
                            <!-- Label input fields rendered here -->
                        </div>
                        
                        <!-- Bounding Box Editor Section -->
                        <div class="bbox-editor-section" id="bbox-editor-section">
                            <h4>üìê Bounding Boxes</h4>
                            
                            <!-- Add new object button - always visible -->
                            <button class="btn-add-object" onclick="addNewObject()" id="btn-add-object">
                                ‚ûï Add New Object
                            </button>
                            
                            <!-- View mode -->
                            <div id="bbox-view-mode">
                                <button class="btn-edit-bbox" onclick="enterBboxEditMode()">
                                    üñäÔ∏è Edit Bounding Boxes
                                </button>
                            </div>
                            
                            <!-- Edit mode (hidden by default) -->
                            <div id="bbox-edit-mode" class="hidden">
                                <div class="bbox-toolbar">
                                    <button onclick="deleteBbox()" id="bbox-delete-btn" disabled title="Delete Selected">
                                        üóëÔ∏è Delete Selected
                                    </button>
                                </div>
                                <p class="bbox-hint" id="bbox-hint">Click a box to select it</p>
                                <div class="bbox-actions">
                                    <button onclick="saveBboxChanges()" class="btn-save">
                                        üíæ Save
                                    </button>
                                    <button onclick="cancelBboxEdit()" class="btn-cancel">
                                        ‚úï Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-info">
                <span id="modal-filename"></span>
                <span id="modal-seq-id"></span>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeDeleteModal()"></div>
        <div class="modal-content delete-modal-content">
            <h2>‚ö†Ô∏è <span id="delete-modal-title">Confirm Delete</span></h2>
            
            <p id="delete-modal-message">Are you sure you want to delete this image?</p>
            
            <div id="delete-file-list" class="file-list">
                <!-- Files listed here -->
            </div>
            
            <p class="warning-text">‚ö†Ô∏è This action cannot be undone. Files will be permanently deleted.</p>
            
            <label class="dont-ask-checkbox">
                <input type="checkbox" id="delete-dont-ask" 
                       onchange="toggleSkipDeleteConfirmation(this.checked)">
                Don't ask again for this session
            </label>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn-delete" id="confirm-delete-btn" onclick="confirmDelete()">
                    Delete
                </button>
            </div>
        </div>
    </div>
    
    <!-- Flag Modal -->
    <div id="flag-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeFlagModal()"></div>
        <div class="modal-content flag-modal-content">
            <h2>üè∑Ô∏è <span id="flag-modal-title">Set Flags</span></h2>
            <p id="flag-modal-subtitle" class="subtitle">Image: filename.jpg</p>
            
            <!-- Quality Flags Section -->
            <div class="flag-section">
                <h3>Quality Flags</h3>
                
                <!-- Bulk mode selector (hidden for single) -->
                <div class="bulk-mode-selector hidden" id="quality-bulk-mode">
                    <label><input type="radio" name="quality-mode" value="set" checked> Set</label>
                    <label><input type="radio" name="quality-mode" value="add"> Add</label>
                    <label><input type="radio" name="quality-mode" value="remove"> Remove</label>
                </div>
                
                <div class="flag-grid" id="quality-flags-grid">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <!-- Perspective Flags Section -->
            <div class="flag-section">
                <h3>Perspective Flags</h3>
                
                <!-- Bulk mode selector (hidden for single) -->
                <div class="bulk-mode-selector hidden" id="perspective-bulk-mode">
                    <label><input type="radio" name="perspective-mode" value="set" checked> Set</label>
                    <label><input type="radio" name="perspective-mode" value="add"> Add</label>
                    <label><input type="radio" name="perspective-mode" value="remove"> Remove</label>
                </div>
                
                <div class="flag-grid" id="perspective-flags-grid">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeFlagModal()">Cancel</button>
                <button class="btn-apply" id="apply-flags-btn" onclick="applyFlags()">Apply</button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeSettings()"></div>
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="modal-close" onclick="closeSettings()">‚úï</button>
            </div>
            
            <!-- Project Info Section -->
            <div class="settings-section">
                <h3>Project Info</h3>
                <div class="project-info">
                    <div class="info-row">
                        <span class="info-label">Name:</span>
                        <span id="settings-project-name">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Directory:</span>
                        <span id="settings-project-dir" class="dir-path">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Images:</span>
                        <span id="settings-image-count">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Created:</span>
                        <span id="settings-created-date">-</span>
                    </div>
                </div>
            </div>
            
            <!-- General Section -->
            <div class="settings-section">
                <h3>General</h3>
                <label class="setting-checkbox">
                    <input type="checkbox" id="setting-skip-confirm" 
                           onchange="updateSetting('skip_delete_confirmation', this.checked)">
                    <span>Skip delete confirmation</span>
                </label>
                
                <div class="setting-group">
                    <label class="setting-label">Default Grid Size:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="setting-grid-size" value="4" 
                                      onchange="updateSetting('grid_size', 4)"> 2√ó2</label>
                        <label><input type="radio" name="setting-grid-size" value="9" 
                                      onchange="updateSetting('grid_size', 9)"> 3√ó3</label>
                        <label><input type="radio" name="setting-grid-size" value="25" 
                                      onchange="updateSetting('grid_size', 25)"> 5√ó5</label>
                        <label><input type="radio" name="setting-grid-size" value="36" 
                                      onchange="updateSetting('grid_size', 36)"> 6√ó6</label>
                    </div>
                </div>
            </div>
            
            <!-- Visible Labels Section -->
            <div class="settings-section">
                <h3>Visible Labels</h3>
                <div class="checkbox-grid" id="visible-labels-settings">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <!-- Quality Flags Section -->
            <div class="settings-section">
                <h3>Quality Flags</h3>
                <div class="flag-manager">
                    <div class="flag-tags" id="quality-flags-tags">
                        <!-- Generated by JS -->
                    </div>
                    <div class="add-flag-row">
                        <input type="text" id="new-quality-flag" placeholder="New flag name">
                        <button onclick="addQualityFlag()">+ Add</button>
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Default for new images:</label>
                    <select id="default-quality-flag" onchange="onDefaultFlagChange('quality', this.value)">
                        <option value="">None</option>
                    </select>
                </div>
            </div>
            
            <!-- Perspective Flags Section -->
            <div class="settings-section">
                <h3>Perspective Flags</h3>
                <div class="flag-manager">
                    <div class="flag-tags" id="perspective-flags-tags">
                        <!-- Generated by JS -->
                    </div>
                    <div class="add-flag-row">
                        <input type="text" id="new-perspective-flag" placeholder="New flag name">
                        <button onclick="addPerspectiveFlag()">+ Add</button>
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Default for new images:</label>
                    <select id="default-perspective-flag" onchange="onDefaultFlagChange('perspective', this.value)">
                        <option value="">None</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-primary" onclick="closeSettings()">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Shortcuts Help Modal -->
    <div id="shortcuts-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeShortcutsHelp()"></div>
        <div class="modal-content shortcuts-modal-content">
            <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
            
            <div class="shortcuts-section">
                <h3>Navigation</h3>
                <div class="shortcut-row"><kbd>W</kbd><span>Previous page</span></div>
                <div class="shortcut-row"><kbd>E</kbd><span>Next page</span></div>
                <div class="shortcut-row"><kbd>1-4</kbd><span>Grid size (when not hovering image)</span></div>
                <div class="shortcut-row"><kbd>G</kbd><span>Custom grid size</span></div>
            </div>
            
            <div class="shortcuts-section">
                <h3>Selection</h3>
                <div class="shortcut-row"><kbd>A</kbd><span>Select all on page</span></div>
                <div class="shortcut-row"><kbd>D</kbd><span>Deselect all</span></div>
                <div class="shortcut-row"><kbd>Space</kbd><span>Open hovered image</span></div>
            </div>
            
            <div class="shortcuts-section">
                <h3>Actions</h3>
                <div class="shortcut-row"><kbd>R</kbd><span>Delete hovered/selected</span></div>
                <div class="shortcut-row"><kbd>F</kbd><span>Flag selected/hovered</span></div>
                <div class="shortcut-row"><kbd>1-9</kbd><span>Set quality flag (hover/selected)</span></div>
                <div class="shortcut-row"><kbd>Q</kbd><span>Cycle quality flag</span></div>
                <div class="shortcut-row"><kbd>P</kbd><span>Perspective flags</span></div>
            </div>
            
            <div class="shortcuts-section">
                <h3>General</h3>
                <div class="shortcut-row"><kbd>\</kbd><span>Toggle filter panel</span></div>
                <div class="shortcut-row"><kbd>,</kbd><span>Open settings</span></div>
                <div class="shortcut-row"><kbd>?</kbd><span>Show this help</span></div>
                <div class="shortcut-row"><kbd>Esc</kbd><span>Close modal / Deselect</span></div>
            </div>
            
            <button class="btn-primary" onclick="closeShortcutsHelp()">Got it</button>
        </div>
    </div>
    
    <!-- Custom Grid Modal -->
    <div id="custom-grid-modal" class="modal hidden">
        <div class="modal-backdrop" onclick="closeCustomGridModal()"></div>
        <div class="modal-content custom-grid-modal-content">
            <h2>üì∑ Custom Grid Size</h2>
            <p class="modal-description">Set a custom number of columns and rows for the image grid.</p>
            
            <div class="custom-grid-inputs">
                <div class="input-group">
                    <label for="custom-cols">Columns</label>
                    <input type="number" id="custom-cols" min="1" max="10" value="4" 
                           onkeydown="if(event.key==='Enter') applyCustomGrid()">
                </div>
                <span class="input-separator">√ó</span>
                <div class="input-group">
                    <label for="custom-rows">Rows</label>
                    <input type="number" id="custom-rows" min="1" max="10" value="4"
                           onkeydown="if(event.key==='Enter') applyCustomGrid()">
                </div>
            </div>
            
            <div class="custom-grid-preview">
                <span class="preview-label">Total images per page:</span>
                <span class="preview-value" id="custom-grid-total">16</span>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCustomGridModal()">Cancel</button>
                <button class="btn-primary" onclick="applyCustomGrid()">Apply</button>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>
    
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
